apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "bitcoin-node.fullname" . }}-config
  labels:
    {{- include "bitcoin-node.labels" . | nindent 4 }}
data:
  bitcoin.conf: |
    # =============================================================================
    # Bitcoin Core Configuration
    # Generated by Helm Chart - {{ .Chart.Name }} v{{ .Chart.Version }}
    # Network: {{ .Values.bitcoin.network }}
    # =============================================================================

    # Run as a server (accept RPC commands)
    server=1

    # Listen for P2P connections
    listen=1

    # Print to console (for container logging)
    printtoconsole=1

    {{- if .Values.bitcoin.rpc.enabled }}
    # RPC Configuration
    rpcuser={{ .Values.bitcoin.rpc.user }}
    rpcallowip={{ .Values.bitcoin.rpc.allowip }}
    rpcbind=0.0.0.0
    rpcport={{ include "bitcoin-node.rpcPort" . }}
    {{- end }}

    # P2P port
    port={{ include "bitcoin-node.p2pPort" . }}

    # User-defined configuration
    {{ .Values.bitcoin.config | nindent 4 }}
